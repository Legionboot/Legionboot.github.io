# Legion Messenger (SPA)

Локальная одностраничная «песочница» мессенджера с монохромным UI в стиле iOS/Material и плавающими окнами.

## Структура проекта

```
index.html
css/
  styles.css          — общие стили и темы
  windows.css         — оформление плавающих окон
js/
  app.js              — точка входа и связывание модулей
  animations.js       — анимации на AnimeJS
  db.js               — локальная база (localStorage)
  gestures.js         — распознавание жестов Pointer Events
  ui.js               — отрисовка списков/окон
  windows.js          — менеджер окон
assets/
  app-icon.svg        — иконка приложения (подготовить самостоятельно)
  avatar-default.svg  — пример аватара (опционально)
```

> Папка `assets/` предназначена для SVG/изображений. В репозитории оставлены только ссылки на файлы — добавьте собственные при необходимости.

## Запуск

1. Сохраните репозиторий локально.
2. Откройте `index.html` в современном браузере (Chrome, Edge, Safari, Firefox — поддержка Pointer Events).
3. Приложение работает полностью офлайн, данные сохраняются в `localStorage` под ключом `local_messenger_db_v1`.

## Основные возможности

- Список бесед, поле ввода сообщений и правая колонка с «репозиторием файлов».
- Плавающие окна (чат, поиск, репозиторий) с перетаскиванием, изменением размера, прилипанием к сетке и жестами pinch/rotate/longpress.
- Монохромная тема с переключением iOS ⇆ Material (кнопка в заголовке, значение сохраняется в `localStorage`).
- Поддержка клавиатурных комбинаций: `Ctrl/Cmd + K` — поиск, `Esc` — закрыть активное окно.
- Импорт/экспорт JSON базы данных, сброс к seed-данным.
- SVG-аватар в шапке с анимацией через AnimeJS.

## API локальной базы (`js/db.js`)

```js
import { db } from './js/db.js';

db.init(seed = false);
db.getConversations();
db.getConversation(id);
db.getMessages(convId, { limit });
db.saveMessage(convId, message);
db.createConversation(meta);
db.markRead(convId);
db.resetDb();
db.exportJson();
db.importJson(json);
db.getFiles();
db.saveWindowState(id, data);
db.getWindowState(id);
db.getAllWindowStates();
```

Каждая функция работает синхронно и обновляет `localStorage`. `saveMessage` экранирует текст (`escapeHtml`).

## Расширение и доработка

- Подключите реальный бэкенд или WebSocket для синхронизации — замените `db.js` на сетевой слой.
- Реализуйте настоящие push-уведомления и WebRTC звонки — подготовлены места в UI и комментарии.
- Добавьте дополнительные окна (например, профиль или быстрые заметки) с помощью `windowManager.createWindow`.
- Включите тёмную тему: достаточно расширить CSS-переменные.

## Жесты и взаимодействия

- **Drag (1 палец/мышь):** перетаскивание окна.
- **Pinch (2 пальца или трекпад):** масштабирование окна.
- **Rotate (2 пальца):** лёгкое вращение окна.
- **Трипальный свайп:** переключение фокуса/сворачивание.
- **Long press:** режим «peek» окна.

Все жесты работают через Pointer Events с `requestAnimationFrame` и дебаунсом.

## Сброс данных

Если нужно начать заново, нажмите кнопку «Сбросить» в правой колонке или выполните в консоли:

```js
localStorage.removeItem('local_messenger_db_v1');
```

При следующем запуске база и окна будут пересозданы из seed-данных.
