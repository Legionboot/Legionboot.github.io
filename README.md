# MonoFlow Messenger · концепт многооконного мессенджера

MonoFlow — статическая Single Page Application, имитирующая тёмный монохромный мессенджер с плавающими окнами, мультитач-жестами и локальной базой данных на `localStorage`. Проект работает полностью локально: достаточно открыть `index.html` в современном браузере.

## Быстрый старт
1. Склонируйте репозиторий или сохраните архив с файлами.
2. Откройте `index.html` в Chrome, Safari, Edge или Firefox (интернет требуется только для CDN AnimeJS).
3. При желании запустите любой статический сервер (`python -m http.server`, `npx serve`), чтобы тестировать на мобильных устройствах.

## Структура файлов
```
├── index.html              # Корневой layout, topbar, контейнер окон
├── css/
│   ├── styles.css          # Токены темы, типографика, элементы, reset (mobile-first)
│   └── windows.css         # Стили окон: drag, resize, snap, состояния
├── js/
│   ├── app.js              # Точка входа: инициализация, хоткеи, связывание модулей
│   ├── animations.js       # Обёртки над AnimeJS для окон, сообщений, аватара
│   ├── db.js               # LocalStorage API (seed-данные, CRUD, экспорт/импорт)
│   ├── gestures.js         # Pointer Events: drag, pinch, longpress, трипальный свайп
│   ├── ui.js               # Рендер DOM-шаблонов: списки чатов, сообщения, модалки
│   └── windows.js          # Менеджер окон: create/focus/close/resize/persist
├── assets/                 # Папка для svg/иконок (app-icon.svg, gesture-guide.svg, avatar-default.svg)
└── README.md
```

## Тёмная тема и дизайн-токены
* Основные переменные находятся в `css/styles.css` (`--bg`, `--surface`, `--card`, `--muted`, `--text`, `--accent`, радиусы и отступы).
* В шапке доступен переключатель `iOS / Material`. Он меняет `data-theme-style` у корневого контейнера и подключает альтернативные тени/радиусы.
* UI mobile-first: на экранах < 900px окна занимают всю ширину, часть окон автоматически сворачивается.
* Дефолтный `outline` отключён, вместо него используется кастомный `:focus-visible` с зелёным акцентом.

## Локальная база данных
Хранилище — `localStorage` под ключом `local_messenger_db_v1`. Seed содержит две беседы ("Команда дизайна", "Infra Sync") и по несколько сообщений.

Доступные функции (см. `js/db.js`):
- `init(seed = false)` — инициализация/ресет до seed.
- `getConversations()` — список бесед, отсортированный по дате последнего сообщения.
- `getConversation(id)` — метаданные конкретной беседы.
- `getMessages(convId)` — массив сообщений.
- `saveMessage(convId, message)` — добавление сообщения с авто-id и обновлением метаданных.
- `createConversation(meta)` — создание новой беседы (используется кнопкой «Новый чат»).
- `markRead(convId)` — сброс счётчика непрочитанных.
- `exportJson()` / `importJson(json)` — экспорт/импорт состояния.
- `resetDb()` — очистка и повторная инициализация seed-данных.

### Импорт / Экспорт
* В правом окне «Репозиторий» нажмите «Импорт / Экспорт», чтобы открыть модальное окно с textarea.
* Кнопка «Копировать JSON» мгновенно заполняет поле экспортом и копирует содержимое в буфер обмена.
* Вставьте подготовленный JSON и нажмите «Импортировать», чтобы восстановить данные.
* «Сбросить БД» возвращает состояние seed.

## Окна, хоткеи и жесты
* Три окна открыты по умолчанию: «Чаты», «Сообщения», «Репозиторий». Их позиции и размеры сохраняются в `localStorage`.
* Окна перетаскиваются за заголовок, поддерживают resize (нижний правый угол) и snap к сетке при ширине ≥ 900px.
* Multitouch: drag (1 палец), pinch (2 пальца, масштаб окна), longpress (тоггл сворачивания), трипальный свайп (переключение фокуса между окнами).
* Клавиатура: `Ctrl/⌘+K` — окно поиска, `Esc` — сворачивание активного core-окна или закрытие второстепенного окна.
* Кнопка аватара открывает окно профиля и запускает анимацию пульсации.

## Расширение
* `db.js` можно заменить на реальный REST/WebSocket API — интерфейс функций остаётся прежним.
* В `gestures.js` легко добавить дополнительные жесты (например, четырёхпальцевый свайп или двойной тап).
* В `app.js` помечены места для интеграции real-time уведомлений, WebRTC-звонков или синхронизации окон между устройствами.
* `animations.js` — базовый слой, который можно расширять эффектами (spring, stagger).

## Список правок/улучшений
- Реализована система плавающих окон с сохранением состояния, снапом и сворачиванием.
- Добавлен менеджер жестов с поддержкой drag/pinch/longpress и трипальных свайпов.
- Введены дизайн-токены тёмной темы, радиусы, отступы и переключатель iOS/Material.
- Улучшена доступность: `aria-*`, кастомный `:focus-visible`, большие touch-зоны, hotkeys.
- Переписана локальная БД с seed-данными, экспортом/импортом и API создания новых чатов.
